# SPECTRA v4 Proposal: BMAD v6 Integration

**Status:** Draft
**Author:** claude-cli (comparative analysis), claude-desktop (BMAD v6 research)
**Date:** 2026-02-10
**Supersedes:** SPECTRA v3.1

---

## 1. Motivation

SPECTRA v3.1 describes itself as "Plan like BMAD. Execute like Ralph. Orchestrate like YCE." But when SPECTRA was designed (Feb 7, 2026), BMAD was at v4 — a set of planning templates. Three days later, BMAD v6.0.0-Beta shipped, transforming BMAD into a full agent orchestration engine with 21+ agents, 50+ workflows, CLI installer, Party Mode, and module system.

SPECTRA's Phase 1 (Specification) currently uses a single `spectra-planner` agent to generate all planning artifacts. This is a pale shadow of what BMAD v6 offers. Meanwhile, SPECTRA's Phase 2-5 (execution, verification, orchestration) have no equivalent in BMAD.

**The opportunity:** Compose BMAD v6 for what it does best (planning) with SPECTRA for what it does best (execution + verification). Don't merge. Compose.

---

## 2. Design Principles

1. **BMAD owns planning. SPECTRA owns execution.** Clear boundary at the plan.md bridge.
2. **No duplicate scale systems.** Unify BMAD's 3 tracks with SPECTRA's 5 levels into one coherent routing decision.
3. **Preserve SPECTRA's unique value.** Signs, wiring proof, cross-model review, fresh-context loops, and verification gates are non-negotiable. BMAD doesn't have these.
4. **Preserve BMAD's unique value.** Party Mode, document sharding, YAML templates, multi-IDE support, and 21+ specialized agents are capabilities SPECTRA shouldn't reinvent.
5. **Installable.** Move from hand-installed shell scripts to a proper package.

---

## 3. Unified Scale System

### Current State (Two Independent Systems)

| SPECTRA Level | BMAD Track |
|---------------|------------|
| Level 0 (Bug fix) | Quick Flow |
| Level 1 (Small feature) | Quick Flow |
| Level 2 (Medium feature) | BMad Method Track |
| Level 3 (Large feature) | BMad Method Track |
| Level 4 (Enterprise) | Enterprise Method Track |

### Proposed: Single Scale Router

```
spectra-assess (new command)
  │
  ├── Uses BMAD *workflow-init to analyze project
  ├── Maps BMAD track recommendation to SPECTRA level
  ├── Routes to appropriate planning depth + execution mode
  │
  ├── Quick Flow → Level 0-1 → spectra-plan (minimal) → sequential loop
  ├── BMad Method → Level 2-3 → BMM agents (full planning) → Agent Teams
  └── Enterprise → Level 4 → BMM agents (extended) → Agent Teams + sprints
```

The `spectra-assess` command replaces manual level selection. It wraps BMAD's `*workflow-init` analysis and outputs a SPECTRA level + BMAD track pair.

---

## 4. Phase Architecture

### Phase 0: Assessment (NEW — BMAD-powered)

```
spectra-assess
  → Runs BMAD *workflow-init analysis
  → Outputs: { level: 3, track: "bmad-method", rationale: "..." }
  → Writes to .spectra/project.yaml
```

Replaces the current manual `--level N` flag in `spectra-init`.

### Phase 1: Specification (UPGRADED — BMAD v6 agents)

**Level 0-1 (Quick Flow):**
- BMAD Quick-Flow agent generates tech-spec only
- Output: `.spectra/constitution.md` + `.spectra/stories/001-*.md`
- No PRD, no architecture (same as v3.1)

**Level 2-3 (BMad Method Track):**
- BMAD PM agent → `.spectra/prd.md`
- BMAD Architect/Winston → `.spectra/architecture.md`
- BMAD Business Analyst → requirements validation
- BMAD UX Designer → UI specs (if applicable)
- BMAD Scrum Master → story decomposition → `.spectra/stories/`
- Party Mode available for cross-functional discussion on complex decisions

**Level 4 (Enterprise Method Track):**
- All of Level 2-3 plus:
- BMAD TEA → test strategy → `.spectra/test-strategy.md`
- Security review agent
- DevOps strategy agent
- BMAD Tech Writer → documentation plan

**Key change:** `spectra-planner` agent is deprecated. BMAD BMM agents handle all planning. The planning artifacts remain in `.spectra/` format — BMAD generates them, SPECTRA consumes them.

### Phase 2: Task Decomposition (UNCHANGED)

```
spectra-plan
  → Reads .spectra/stories/*.md (generated by BMAD agents in Phase 1)
  → Generates .spectra/plan.md (task checkboxes with verify commands)
  → Uses claude --agent spectra-planner (kept for plan.md generation only)
```

The bridge between BMAD planning output and SPECTRA execution input. `spectra-planner` is renamed to `spectra-plan-bridge` to clarify its narrower role: it doesn't plan, it converts BMAD stories into SPECTRA's executable plan.md format.

### Phase 3: Execution (UNCHANGED)

```
spectra-loop
  → Level 0-2: Sequential loop (spectra-loop-legacy.sh)
  → Level 3+: Agent Teams (spectra-lead)
  → Fresh context per iteration
  → Parallel build, serial verify (Doctrine 5)
```

No BMAD involvement. This is SPECTRA's core value.

### Phase 4: Verification (UNCHANGED)

```
spectra-verifier → 4-step audit
  → Step 1: Task verify command
  → Step 2: Full regression suite
  → Step 3: Evidence chain (commit hash matches task)
  → Step 4: Wiring proof (dead import detection, pipeline check)
```

Signs, wiring proof, cross-model review — all preserved. No BMAD equivalent exists.

### Phase 5: Delivery (MINOR ENHANCEMENT)

```
spectra-lead → ship
  → Git commit + PR
  → Slack notification
  → Linear update
  → NEW: BMAD Tech Writer agent generates release notes (Level 3+)
```

Minor addition: for Level 3+ projects, invoke BMAD's Tech Writer agent to auto-generate release documentation from the completed plan.md and git log.

---

## 5. Agent Roster (v4)

### SPECTRA Agents (execution-focused, kept)

| Agent | Model | Role | Change from v3.1 |
|-------|-------|------|-------------------|
| spectra-lead | Opus | Team coordinator | Unchanged |
| spectra-builder | Opus | Code implementer | Unchanged |
| spectra-verifier | Opus | Quality gate | Unchanged |
| spectra-reviewer | Sonnet | Cross-model adversarial review | Unchanged |
| spectra-auditor | Haiku | Pre-flight guardrails scan | Unchanged |
| spectra-plan-bridge | Opus | Stories → plan.md conversion | Renamed from spectra-planner, narrower scope |
| spectra-scout | Haiku | Pre-planning investigation | Unchanged |

### BMAD Agents (planning-focused, new integration)

| Agent | Source | Role | When Used |
|-------|--------|------|-----------|
| BMad Master | BMM | Orchestrates planning agents | Level 2+ |
| PM | BMM | Product requirements | Level 2+ |
| Architect (Winston) | BMM | System design | Level 3+ |
| Business Analyst | BMM | Requirements validation | Level 2+ |
| UX Designer | BMM | UI/UX specifications | When applicable |
| Scrum Master | BMM | Story decomposition | Level 2+ |
| TEA | BMM | Test strategy | Level 4 |
| Tech Writer | BMM | Release documentation | Level 3+ |
| Quick-Flow | BMM | Fast tech-spec generation | Level 0-1 |

### Deprecated

| Agent | Reason |
|-------|--------|
| spectra-planner | Replaced by BMM agents for planning, spectra-plan-bridge for conversion |
| spectra-orchestrator | Already deprecated in v3.1 |

---

## 6. Installation (NEW)

### Current (v3.1): Manual

```bash
# Hand-copy files to ~/.spectra/
# Hand-copy agents to ~/.claude/agents/
# Hand-create symlinks in ~/.local/bin/
# Hand-edit ~/.claude/settings.json for hooks
```

### Proposed (v4): CLI Installer

```bash
# Install SPECTRA (includes BMAD as dependency)
npx spectra install

# Or install with specific options
npx spectra install --modules bmm --ide claude-code

# This automatically:
#   1. Installs BMAD v6 core + BMM module (via npx bmad-method)
#   2. Installs SPECTRA agents to ~/.claude/agents/
#   3. Installs SPECTRA scripts to ~/.spectra/bin/
#   4. Creates symlinks in ~/.local/bin/
#   5. Configures hooks in ~/.claude/settings.json
#   6. Runs spectra-preflight to verify .env tokens
#   7. Prompts for integration tokens (Linear, Slack, GitHub)
```

### Upgrade Path

```bash
npx spectra upgrade    # Updates SPECTRA + BMAD, preserves .env and customizations
```

---

## 7. Template System Upgrade

### Current (v3.1): Static Markdown

```markdown
# PROMPT_build.md
You are an autonomous coding agent...
```

### Proposed (v4): BMAD-style YAML Templates

```yaml
# PROMPT_build.yaml
name: spectra-build-prompt
version: 4.0
variables:
  - constitution: .spectra/constitution.md
  - plan: .spectra/plan.md
  - guardrails: .spectra/guardrails.md
conditions:
  - if: level >= 3
    include: wiring-proof-checklist
  - if: signs_count > 0
    include: signs-section
template: |
  # SPECTRA Build Agent

  ## Constitution
  {{constitution}}

  ## Current Plan
  {{plan}}

  ^^IF signs_count > 0^^
  ## Signs (Guardrails)
  {{guardrails}}
  ^^ENDIF^^

  [[LLM: Read the plan and implement the first unchecked task]]
```

Benefits: conditional sections, variable interpolation, document sharding for large projects, consistency via `technical-preferences.md`.

---

## 8. New: Party Mode for Troubleshooting

BMAD's Party Mode (multi-agent discussion per message) introduces a pattern useful for SPECTRA troubleshooting:

```
spectra-party (new command)
  → When a task is STUCK after max retries
  → Spawns BMAD Party Mode with:
    - spectra-builder (what I tried)
    - spectra-verifier (what failed)
    - BMAD Architect (alternative approaches)
    - BMAD PM (scope reduction options)
  → Multi-agent discussion produces:
    - Root cause hypothesis
    - Alternative implementation plan
    - Scope adjustment if needed
  → Output feeds back into plan.md as revised task
```

This replaces the current STUCK → split task → retry pattern with a more intelligent collaborative debugging approach.

---

## 9. Migration Path

### v3.1 → v4 (Non-breaking)

1. **Phase 1:** Ship `spectra-assess` command (wraps BMAD `*workflow-init`)
2. **Phase 2:** Add BMAD BMM as optional planning backend (`spectra-plan --bmad`)
3. **Phase 3:** Ship `npx spectra install` CLI
4. **Phase 4:** Rename `spectra-planner` → `spectra-plan-bridge`
5. **Phase 5:** Add BMAD YAML template support alongside existing markdown
6. **Phase 6:** Add `spectra-party` for STUCK troubleshooting

Each phase is independently shippable. v3.1 continues to work throughout.

---

## 10. What NOT to Change

These SPECTRA capabilities have no BMAD equivalent and must be preserved exactly:

1. **Fresh-context execution loop** — Ralph heritage, battle-tested
2. **Verification gates** — mandatory, not optional
3. **Signs system** — cross-project learned guardrails
4. **Wiring Proof** — 3-level integration enforcement
5. **Cross-model review** — Sonnet validates Opus (architectural diversity)
6. **Agent Teams orchestration** — spectra-lead coordinates parallel builders
7. **Doctrine 5** — parallel build, serial verify
8. **Evidence chain** — commit hash + test results + screenshots
9. **Preflight verification** — infrastructure readiness checks
10. **Hook architecture** — safety nets, not orchestrators

---

## 11. Open Questions

1. **Package format:** Should SPECTRA be an npm package (like BMAD) or keep shell scripts + Claude agents? npm gives better distribution but adds Node.js as a dependency.

2. **BMAD as hard dependency vs optional:** Should `npx spectra install` always include BMAD, or allow SPECTRA-only installation with manual planning?

3. **Agent definition format:** Should SPECTRA agents migrate to BMAD's agent format (with personas, menus, activation steps), or keep the current Claude Code YAML frontmatter format?

4. **Party Mode scope:** Only for STUCK troubleshooting, or also for architecture decisions during planning?

5. **BMAD version pinning:** Should SPECTRA pin to a specific BMAD v6 release, or track latest?

6. **Module marketplace:** Should SPECTRA be listed as a BMAD module in the upcoming marketplace?

---

## 12. Timeline Estimate

| Phase | Scope | Dependency |
|-------|-------|------------|
| Phase 1: spectra-assess | New command + BMAD integration | BMAD v6 stable release |
| Phase 2: BMM planning backend | Optional flag on spectra-plan | Phase 1 |
| Phase 3: CLI installer | npx spectra install | Phase 2 |
| Phase 4: Agent rename | spectra-planner → spectra-plan-bridge | Phase 2 |
| Phase 5: YAML templates | BMAD-style template system | Phase 3 |
| Phase 6: spectra-party | STUCK troubleshooting via Party Mode | Phase 2 |

---

*SPECTRA v4 — Compose, don't merge. BMAD plans, SPECTRA executes.*
